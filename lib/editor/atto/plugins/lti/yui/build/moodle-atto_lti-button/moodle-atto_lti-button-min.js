YUI.add("moodle-atto_lti-button",function(m,t){require(["core/str"],function(t){var i=null,e=t.get_string("erroroccurred","atto_lti");$.when(e).done(function(t){i=t}),document.CALLBACKS={handleError:function(t){alert(i);for(var e=0;e<t.length;e++)console.error(t[e])}}}),m.namespace("M.atto_lti").Button=m.Base.create("button",m.M.editor_atto.EditorPlugin,[],{_CREATEACTIVITYURL:"/lib/editor/atto/plugins/lti/view.php",_CONTENT_ITEM_SELECTION_URL:"/lib/editor/atto/plugins/lti/contentitem.php",_panel:null,_addTool:function(t,l){t.preventDefault();var n,o=this._createResourceLinkId(),r=this.get("host"),c=this._course;document.CALLBACKS["f"+o]=function(t){var e,i,a;if(t){for(e=0;e<t["@graph"].length;e++)i=t["@graph"][e],a=(new m.M.atto_lti.PlacementStrategyFactory).strategyFor(i,c,o,l).toHtml,r.insertContentAtFocusPoint(a(i));r.saveSelection(),r.updateOriginal(),n.hide(),n.destroy()}},this._panel=new M.core.dialogue({bodyContent:'<iframe src="'+this._CONTENT_ITEM_SELECTION_URL+"?course="+this._course.id+"&id="+l.id+"&callback=f"+o+'" width="100%" height="100%"></iframe>',headerContent:l.name,width:"67%",height:"66%",draggable:!1,visible:!0,zindex:100,modal:!0,focusOnPreviousTargetAfterHide:!0,render:!0}),this._panel.after("visibleChange",this._panel.destroy,this),n=this._panel},initializer:function(t){var e;t.toolTypes&&0!==t.toolTypes.length&&(this._course=t.course,this._createResourceLinkId=(e=t.resourcebase,function(){return e+"_"+(new Date).getTime()}),this.addToolbarMenu({icon:"/theme/image.php/uclashared/casa/1527094325/icon",globalItemConfig:{callback:this._addTool},items:t.toolTypes.map(function(t){return{text:t.name,callbackArgs:t}})}))}}),m.namespace("M.atto_lti").PlacementStrategyFactory=function(){this.strategyFor=function(t,e,i,a){var l=m.M.atto_lti.EmbeddedContentRenderingStrategy;if(("application/vnd.ims.lti.v1.ltilink"===t.mediaType||t.placementAdvice)&&(l=m.M.atto_lti.IframeRenderingStrategy,t.placementAdvice))switch(t.placementAdvice.presentationDocumentTarget){case"window":case"popup":case"overlay":l=m.M.atto_lti.PlaceholderRenderingStrategy;break;case"iframe":l=m.M.atto_lti.IframeRenderingStrategy;break;case"embed":case"frame":l=m.M.atto_lti.EmbeddedContentRenderingStrategy;break;default:alert("Unsupported presentation target: "+t.placementAdvice.presentationDocumentTarget)}return new l(t,e,i,a)}},m.namespace("M.atto_lti").EmbeddedContentRenderingStrategy=function(t,e,i,a){var l,n,o=t.mediaType.split("/"),r=o[0],c="400px",s="250px",d=c,h=72,u=parseInt(s)-parseInt(72)+"px";switch(t.displayWidth||(t.displayWidth=c),t.text&&t.text.length||(s="72px"),t.displayHeight||(t.displayHeight=s),t.thumbnail&&(t.thumbnail.width||(t.thumbnail.width=128),t.thumbnail.height||(t.thumbnail.height=72),d=parseInt(t.displayWidth)-parseInt(t.thumbnail.width)-5+"px",h=parseInt(t.thumbnail.height)+"px"),l={image:m.Handlebars.compile('<img src="{{url}}" alt="{{alt}}" {{#if width}}width="{{width}}" {{/if}}{{#if height}}height="{{height}}" {{/if}}{{#if presentation}}role="presentation" {{/if}}{{#if customstyle}}style="{{customstyle}}" {{/if}}{{#if classlist}}class="{{classlist}}" {{/if}}{{#if id}}id="{{id}}" {{/if}} />'),ltiLink:m.Handlebars.compile('<iframe src="/lib/editor/atto/plugins/lti/view.php?custom={{custom}}&course={{course.id}}&ltitypeid={{toolid}}&resourcelinkid={{resourcelinkid}}{{#if item.url}}&contenturl={{item.url}}{{/if}}" {{#if item.placementAdvice.width}} width="{{item.placementAdvice.displayWidth}}"{{/if}} {{#if item.placementAdvice.height}} height="{{item.placementAdvice.displayHeight}}"{{/if}} />'),audio:m.Handlebars.compile('<audio src="{{url}}" controls="controls">Your computer does not support audio playback</audio>'),video:m.Handlebars.compile('<video src="{{url}}"{{#if width}}width="{{width}}" {{/if}}{{#else}}{{#if placementAdvice.width}}width="{{width}}" {{/if}}{{/else}}{{#if height}}height="{{height}}" {{/if}}{{#else}}{{#if placementAdvice.height}}height="{{height}}" {{/if}}{{/else}}></video>'),link:m.Handlebars.compile('<div style="width:{{item.displayWidth}};height:{{item.displayHeight}};" ><div style="width:{{item.displayWidth}};height:{{titleHeight}};"><a href="/lib/editor/atto/plugins/lti/view.php?custom={{custom}}&course={{course.id}}&ltitypeid={{toolid}}&resourcelinkid={{resourcelinkid}}{{#if item.url}}&contenturl={{item.url}}{{/if}}" {{#if item.placementAdvice.windowTarget}}target="{{item.placementAdvice.windowTarget}}" {{/if}}>{{#if item.thumbnail}}<img src={{item.thumbnail.id}} alt="content thumbnail"style="float:left;margin-right:5px;width:{{item.thumbnail.width}}px;height:{{item.thumbnail.height}}px;" /> {{/if}}<div style="float:left;font-size:20px;font-weight:bold;max-width:{{titleWidth}};height:{{titleHeight}};line-height:{{titleHeight}};">{{item.title}}</div></a></div>{{#if item.text}}<div style="width:{{item.displayWidth}};max-height:{{textHeight}};"></span>{{item.text}}</span></div>{{/if}}</div>')},r){case"application":"vnd.ims.lti.v1.ltilink"==o[1]?n=l.ltiLink({item:t,toolid:a.id,resourcelinkid:i,course:e}):alert("Unrecognized application subtype");break;case"text":n=l.link({item:t,custom:encodeURIComponent(JSON.stringify(t.custom)),course:e,toolid:a.id,resourcelnkid:i,textHeight:u,titleHeight:h,titleWidth:d});break;case"image":n=l.image({url:t.url,alt:t.title,width:t.width,height:t.height,presentation:!0});break;case"audio":n=l.audio(t);break;case"video":n=l.video(t);break;default:alert("Unrecognized type")}this.toHtml=function(){return n}},m.namespace("M.atto_lti").ImageRenderingStrategy=function(t,e,i,a){var l=m.Handlebars.compile('<img src="{{url}}" alt="{{title}}" {{#if width}}width="{{width}}" {{/if}}{{#if height}}height="{{height}}" {{/if}}{{#if presentation}}role="presentation" {{/if}}{{#if customstyle}}style="{{customstyle}}" {{/if}}{{#if classlist}}class="{{classlist}}" {{/if}}{{#if id}}id="{{id}}" {{/if}}/>');this.toHtml=function(){return l({item:t,custom:JSON.stringify(t.custom),courseId:e.id,resourcelinkid:i,ltiTypeId:a.id})}},m.namespace(
"M.atto_lti").IframeRenderingStrategy=function(t,e,i,a){var l;t.url!==a.baseurl&&t.url!==a.config.toolurl_ContentItemSelectionRequest&&(t.useCustomUrl=!0),l=m.Handlebars.compile('<iframe src="/lib/editor/atto/plugins/lti/view.php?course={{courseId}}&ltitypeid={{ltiTypeId}}&custom={{custom}}{{#if item.useCustomUrl}}&contenturl={{item.url}}{{/if}}&resourcelinkid={{resourcelinkid}}"  {{#if item.placementAdvice.displayWidth}}width="{{item.placementAdvice.displayWidth}}" {{/if}} {{#if item.placementAdvice.displayHeight}}height="{{item.placementAdvice.displayHeight}}" {{/if}}></iframe>'),this.toHtml=function(){return l({item:t,custom:JSON.stringify(t.custom),courseId:e.id,resourcelinkid:i,ltiTypeId:a.id})}},m.namespace("M.atto_lti").PlaceholderRenderingStrategy=function(t){var e,i;switch(m.M.atto_lti.PlaceholderRenderingStrategy.superclass.constructor.apply(this,arguments),e=new("undefined"!=typeof t.thumbnail?m.M.atto_lti.PreviewImagePlaceholderStrategy:"undefined"!=typeof t.icon?m.M.atto_lti.IconPlaceholderStrategy:m.M.atto_lti.TextPlaceholderStrategy)(t),t.placementAdvice.presentationDocumentTarget){case"window":case"popup":case"overlay":i=new m.M.atto_lti.NewWindowTargetAction(t,e);break;default:alert("Unrecognized preesntation document target")}this.toHtml=function(){return i.toHtml()}},m.namespace("M.atto_lti").PreviewImagePlaceholderStrategy=function(t){m.M.atto_lti.PreviewImagePlaceholderStrategy.superclass.constructor.call(this,t);var e=m.Handlebars.compile('<img src="{{thumbnail[@id}}" width="{{thumbnail.width}}"  height="{{thumbnail.height}}"  alt="{{title}}" />');this.toHtml=function(){return e({thumnbail:t.thumbnail,title:t.title})}},m.namespace("M.atto_lti").IconPlaceholderStrategy=function(t){m.M.atto_lti.IconPlaceholderStrategy.superclass.constructor.call(this,t);var e=m.Handlebars.compile('<img src="{{icon[@id]}}" width="{{icon.width}}"  height="{{icon.height}}"  alt="{{title}}" />');this.toHtml=function(){return e({icon:t.icon,title:t.title})}},m.namespace("M.atto_lti").TextPlaceholderStrategy=function(t){m.M.atto_lti.TextPlaceholderStrategy.superclass.constructor.call(this,t),this.toHtml=function(){return t.text?t.text:t.title}},m.namespace("M.atto_lti").NewWindowTargetAction=function(t,e){var i=m.Handlebars.compile('<a href="{{item.url}}" target="_blank">{{placeholder.toHtml()}}</a>');this.toHtml=function(){return i({item:t,placeholder:e})}}},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});