YUI.add("moodle-atto_lti-button",function(e,t){require(["core/str"],function(e){var t=null,n=e.get_string("erroroccurred","atto_lti");$.when(n).done(function(e){t=e}),document.CALLBACKS={handleError:function(e){alert(t);for(var n=0;n<e.length;n++)console.error(e[n])}}}),e.namespace("M.atto_lti").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{_CREATEACTIVITYURL:"/lib/editor/atto/plugins/lti/view.php",_CONTENT_ITEM_SELECTION_URL:"/lib/editor/atto/plugins/lti/contentitem.php",_panel:null,_addTool:function(t,n){t.preventDefault();var r=this._createResourceLinkId(),i=this.get("host"),s,o=this._course;document.CALLBACKS["f"+r]=function(t){if(!t)return;for(var u=0;u<t["@graph"].length;u++){var a=t["@graph"][u],f=new e.M.atto_lti.PlacementStrategyFactory,l=f.strategyFor(a,o,r,n),c=l.toHtml;i.insertContentAtFocusPoint(c(a))}i.saveSelection(),i.updateOriginal(),s.hide()},this._panel=new M.core.dialogue({bodyContent:'<iframe src="'+this._CONTENT_ITEM_SELECTION_URL+"?course="+this._course.id+"&id="+n.id+"&callback=f"+r+'" width="100%" height="100%"></iframe>',headerContent:n.name,width:"67%",height:"66%",draggable:!1,visible:!0,zindex:100,modal:!0,focusOnPreviousTargetAfterHide:!0,render:!0}),s=this._panel},initializer:function(e){this._course=e.course,this._createResourceLinkId=function(e){return function(){return e+"_"+(new Date).getTime()}}(e.resourcebase),this.addToolbarMenu({icon:"/theme/image.php/uclashared/casa/1527094325/icon",globalItemConfig:{callback:this._addTool},items:e.toolTypes.map(function(e){return{text:e.name,callbackArgs:e}})})}}),e.namespace("M.atto_lti").PlacementStrategyFactory=function(){this.strategyFor=function(t,n,r,i){var s=e.M.atto_lti.EmbeddedContentRenderingStrategy;if(t.mediaType==="application/vnd.ims.lti.v1.ltilink"||t.placementAdvice){s=e.M.atto_lti.IframeRenderingStrategy;if(t.placementAdvice)switch(t.placementAdvice.presentationDocumentTarget){case"window":case"popup":case"overlay":s=e.M.atto_lti.PlaceholderRenderingStrategy;break;case"iframe":s=e.M.atto_lti.IframeRenderingStrategy;break;case"embed":case"frame":s=e.M.atto_lti.EmbeddedContentRenderingStrategy;break;default:alert("Unsupported presentation target: "+t.placementAdvice.presentationDocumentTarget)}}var o=new s(t,n,r,i);return o}},e.namespace("M.atto_lti").EmbeddedContentRenderingStrategy=function(t,n,r,i){var s=t.mediaType.split("/"),o=s[0],u={image:e.Handlebars.compile('<img src="{{url}}" alt="{{alt}}" {{#if width}}width="{{width}}" {{/if}}{{#if height}}height="{{height}}" {{/if}}{{#if presentation}}role="presentation" {{/if}}{{#if customstyle}}style="{{customstyle}}" {{/if}}{{#if classlist}}class="{{classlist}}" {{/if}}{{#if id}}id="{{id}}" {{/if}} />'),ltiLink:e.Handlebars.compile('<iframe src="/lib/editor/atto/plugins/lti/view.php?custom={{custom}}&course={{course.id}}&ltitypeid={{toolid}}&resourcelinkid={{resourcelinkid}}{{#if item.url}}&contenturl={{item.url}}{{/if}}" {{#if item.placementAdvice.width}} width="{{item.placementAdvice.displayWidth}}"{{/if}} {{#if item.placementAdvice.height}} height="{{item.placementAdvice.displayHeight}}"{{/if}} />'),audio:e.Handlebars.compile('<audio src="{{url}}" controls="controls">Your computer does not support audio playback</audio>'),video:e.Handlebars.compile('<video src="{{url}}"{{#if width}}width="{{width}}" {{/if}}{{#if height}}height="{{height}}" {{/if}}{{#if presentationAdvice.width}}width="{{width}}" {{/if}}{{#if presentationAdvice.height}}height="{{height}}" {{/if}}></video>')};console.log(t);var a;console.log(o),console.log(n);switch(o){case"application":s[1]=="vnd.ims.lti.v1.ltilink"?a=u.ltiLink({item:t,toolid:i.id,resourcelinkid:r,course:n}):alert("Unrecognized application subtype");break;case"text":a=t.text;break;case"image":a=u.image({url:t.url,alt:t.title,width:t.width,height:t.height,presentation:!0});break;case"audio":a=u.audio(t);break;case"video":a=u.video(t);break;default:alert("Unrecognized type")}this.toHtml=function(){return a}},e.namespace("M.atto_lti").ImageRenderingStrategy=function(t,n,r,i){var s=e.Handlebars.compile('<img src="{{url}}" alt="{{title}}" {{#if width}}width="{{width}}" {{/if}}{{#if height}}height="{{height}}" {{/if}}{{#if presentation}}role="presentation" {{/if}}{{#if customstyle}}style="{{customstyle}}" {{/if}}{{#if classlist}}class="{{classlist}}" {{/if}}{{#if id}}id="{{id}}" {{/if}}/>');this.toHtml=function(){return s({item:t})}},e.namespace("M.atto_lti").IframeRenderingStrategy=function(t,n,r,i){var s;t.url!==i.baseurl&&t.url!==i.config.toolurl_ContentItemSelectionRequest&&(t.useCustomUrl=!0),s=e.Handlebars.compile('<iframe src="/lib/editor/atto/plugins/lti/view.php?course={{courseId}}&ltitypeid={{ltiTypeId}}&custom={{custom}}{{#if item.useCustomUrl}}&contenturl={{item.url}}{{/if}}&resourcelinkid={{resourcelinkid}}"  {{#if item.placementAdvice.displayWidth}}width="{{item.placementAdvice.displayWidth}}" {{/if}} {{#if item.placementAdvice.displayHeight}}height="{{item.placementAdvice.displayHeight}}" {{/if}}></iframe>'),this.toHtml=function(){return s({item:t,custom:JSON.stringify(t.custom),courseId:n.id,resourcelinkid:r,ltiTypeId:i.id})}},e.namespace("M.atto_lti").PlaceholderRenderingStrategy=function(t){e.M.atto_lti.PlaceholderRenderingStrategy.superclass.constructor.apply(this,arguments);var n,r,i;typeof t.thumbnail!="undefined"?r=e.M.atto_lti.PreviewImagePlaceholderStrategy:typeof t.icon!="undefined"?r=e.M.atto_lti.IconPlaceholderStrategy:r=e.M.atto_lti.TextPlaceholderStrategy,n=new r(t);switch(t.placementAdvice.presentationDocumentTarget){case"window":case"popup":case"overlay":i=new e.M.atto_lti.NewWindowTargetAction(t,n);break;default:alert("Unrecognized preesntation document target")}this.toHtml=function(){return i.toHtml()}},e.namespace("M.atto_lti").PreviewImagePlaceholderStrategy=function(t){e.M.atto_lti.PreviewImagePlaceholderStrategy.superclass.constructor.call(this,t);var n=e.Handlebars.compile('<img src="{{thumbnail[@id}}" width="{{thumbnail.width}}"  height="{{thumbnail.height}}"  alt="{{title}}" />'
);this.toHtml=function(){return n({thumnbail:t.thumbnail,title:t.title})}},e.namespace("M.atto_lti").IconPlaceholderStrategy=function(t){e.M.atto_lti.IconPlaceholderStrategy.superclass.constructor.call(this,t);var n=e.Handlebars.compile('<img src="{{icon[@id]}}" width="{{icon.width}}"  height="{{icon.height}}"  alt="{{title}}" />');this.toHtml=function(){return n({icon:t.icon,title:t.title})}},e.namespace("M.atto_lti").TextPlaceholderStrategy=function(t){e.M.atto_lti.TextPlaceholderStrategy.superclass.constructor.call(this,t),this.toHtml=function(){return t.text?t.text:t.title}},e.namespace("M.atto_lti").NewWindowTargetAction=function(t,n){var r=e.Handlebars.compile('<a href="{{item.url}}" target="_blank">{{placeholder.toHtml()}}</a>');this.toHtml=function(){return r({item:t,placeholder:n})}}},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
